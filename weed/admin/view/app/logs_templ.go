// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package app

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"github.com/seaweedfs/seaweedfs/weed/admin/dash"
)

func Logs(data dash.LogsData) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\"><h1 class=\"h2\">Audit Logs</h1><div class=\"btn-toolbar mb-2 mb-md-0\"><div class=\"input-group me-2\"><span class=\"input-group-text\">Filter</span> <input type=\"text\" class=\"form-control\" id=\"logSearch\" placeholder=\"Search logs...\" onkeyup=\"applyFilters()\"></div><div class=\"btn-group me-2\" role=\"group\" aria-label=\"Level filters\"><input type=\"checkbox\" class=\"btn-check\" id=\"checkInfo\" checked onchange=\"applyFilters()\"> <label class=\"btn btn-outline-info\" for=\"checkInfo\">INFO</label> <input type=\"checkbox\" class=\"btn-check\" id=\"checkWarn\" checked onchange=\"applyFilters()\"> <label class=\"btn btn-outline-warning\" for=\"checkWarn\">WARN</label> <input type=\"checkbox\" class=\"btn-check\" id=\"checkError\" checked onchange=\"applyFilters()\"> <label class=\"btn btn-outline-danger\" for=\"checkError\">ERROR</label> <input type=\"checkbox\" class=\"btn-check\" id=\"checkHttp\" checked onchange=\"applyFilters()\"> <label class=\"btn btn-outline-primary\" for=\"checkHttp\">HTTP</label></div><div class=\"btn-group me-2\"><button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" onclick=\"fetchLogs()\">Refresh</button> <button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" onclick=\"toggleAutoRefresh(this)\" id=\"autoRefreshBtn\">Auto-Refresh: OFF</button></div></div></div><div class=\"table-responsive\"><table class=\"table table-striped table-sm\" id=\"logsTable\"><thead><tr><th scope=\"col\" style=\"width: 15%\">Timestamp</th><th scope=\"col\" style=\"width: 5%\">Level</th><th scope=\"col\" style=\"width: 10%\">User</th><th scope=\"col\">Message</th></tr></thead> <tbody id=\"logsTableBody\"><tr><td colspan=\"4\" class=\"text-center\">Loading logs...</td></tr></tbody></table></div><script>\n\t\tvar lastLogId = 0;\n        // Clean up previous interval if it exists (prevents multiple timers on navigation)\n        if (window.logRefreshInterval) {\n            clearInterval(window.logRefreshInterval);\n            window.logRefreshInterval = null;\n        }\n\n\t\tfunction formatTime(isoString) {\n\t\t\tconst date = new Date(isoString);\n\t\t\treturn date.toLocaleString();\n\t\t}\n\n\t\tfunction getLevelBadge(level) {\n\t\t\tlet badgeClass = \"bg-secondary\";\n\t\t\tswitch (level) {\n\t\t\t\tcase \"INFO\": badgeClass = \"bg-info text-dark\"; break;\n\t\t\t\tcase \"WARN\": badgeClass = \"bg-warning text-dark\"; break;\n\t\t\t\tcase \"ERROR\": badgeClass = \"bg-danger\"; break;\n\t\t\t\tcase \"FATAL\": badgeClass = \"bg-dark\"; break;\n\t\t\t\tcase \"HTTP\": badgeClass = \"bg-primary\"; break;\n\t\t\t}\n\t\t\treturn `<span class=\"badge ${badgeClass}\">${level}</span>`;\n\t\t}\n\n\t\tfunction fetchLogs() {\n\t\t\tfetch('/api/logs?limit=1000') // Fetch all logs initially/on refresh\n\t\t\t\t.then(response => response.json())\n\t\t\t\t.then(logs => {\n\t\t\t\t\tconst tbody = document.getElementById('logsTableBody');\n                    if (!tbody) return; // Guard against navigation away during fetch\n\t\t\t\t\t\n\t\t\t\t\t// Clear table if we are doing a full refresh\n\t\t\t\t\ttbody.innerHTML = '';\n\n\t\t\t\t\tif (logs.length === 0) {\n\t\t\t\t\t\ttbody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center\">No logs found</td></tr>';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Sort newest first\n\t\t\t\t\tlogs.sort((a, b) => b.id - a.id);\n\n\t\t\t\t\tlogs.forEach(log => {\n\t\t\t\t\t\tconst row = document.createElement('tr');\n                        // Use safe user default\n                        const user = log.user || \"-\";\n\t\t\t\t\t\trow.innerHTML = `\n\t\t\t\t\t\t\t<td>${formatTime(log.timestamp)}</td>\n\t\t\t\t\t\t\t<td>${getLevelBadge(log.level)}</td>\n                            <td>${user}</td>\n\t\t\t\t\t\t\t<td style=\"font-family: monospace; white-space: pre-wrap; word-break: break-all;\">${log.message}</td>\n\t\t\t\t\t\t`;\n\t\t\t\t\t\ttbody.appendChild(row);\n\t\t\t\t\t\tif (log.id > lastLogId) {\n\t\t\t\t\t\t\tlastLogId = log.id;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n                    applyFilters(); // Re-apply filters after rendering\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tconsole.error('Error fetching logs:', error);\n\t\t\t\t\tconst tbody = document.getElementById('logsTableBody');\n                    if (tbody) {\n\t\t\t\t\t    tbody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center text-danger\">Error loading logs</td></tr>';\n                    }\n\t\t\t\t});\n\t\t}\n\n        function applyFilters() {\n            const searchInput = document.getElementById('logSearch');\n            if (!searchInput) return;\n\n            const searchText = searchInput.value.toLowerCase();\n            const showInfo = document.getElementById('checkInfo').checked;\n            const showWarn = document.getElementById('checkWarn').checked;\n            const showError = document.getElementById('checkError').checked;\n            const showHttp = document.getElementById('checkHttp').checked;\n\n            const rows = document.querySelectorAll('#logsTableBody tr');\n            rows.forEach(row => {\n                if (row.cells.length < 4) return; // Skip \"No logs found\" or \"Loading\" rows\n\n                const levelCell = row.cells[1].innerText; // \"INFO\", \"WARN\", etc\n                const message = row.cells[3].innerText.toLowerCase();\n                \n                let matchesLevel = false;\n                if (levelCell === 'INFO' && showInfo) matchesLevel = true;\n                else if (levelCell === 'WARN' && showWarn) matchesLevel = true;\n                else if ((levelCell === 'ERROR' || levelCell === 'FATAL') && showError) matchesLevel = true;\n                else if (levelCell === 'HTTP' && showHttp) matchesLevel = true;\n\n                const matchesSearch = message.includes(searchText);\n\n                if (matchesLevel && matchesSearch) {\n                    row.style.display = '';\n                } else {\n                    row.style.display = 'none';\n                }\n            });\n        }\n\n\t\tfunction toggleAutoRefresh(btn) {\n\t\t\tif (window.logRefreshInterval) {\n\t\t\t\tclearInterval(window.logRefreshInterval);\n\t\t\t\twindow.logRefreshInterval = null;\n\t\t\t\tbtn.innerText = \"Auto-Refresh: OFF\";\n\t\t\t\tbtn.classList.remove(\"active\");\n\t\t\t} else {\n\t\t\t\tfetchLogs(); // Fetch immediately\n\t\t\t\twindow.logRefreshInterval = setInterval(fetchLogs, 2000);\n\t\t\t\tbtn.innerText = \"Auto-Refresh: ON\";\n\t\t\t\tbtn.classList.add(\"active\");\n\t\t\t}\n\t\t}\n\n\t\t// Initial fetch - Handle both full page load and HTMX swap\n        if (document.readyState === \"loading\") {\n             document.addEventListener('DOMContentLoaded', fetchLogs);\n        } else {\n             fetchLogs();\n        }\n\t</script>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
