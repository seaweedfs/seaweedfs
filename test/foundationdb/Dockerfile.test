# Test environment with Go and FoundationDB support
FROM golang:1.24-bookworm

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    wget \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Download and install FoundationDB client libraries
RUN wget -q https://github.com/apple/foundationdb/releases/download/7.4.5/foundationdb-clients_7.4.5-1_amd64.deb \
    && dpkg -i foundationdb-clients_7.4.5-1_amd64.deb || apt-get install -f -y \
    && rm foundationdb-clients_7.4.5-1_amd64.deb

# Set up Go environment for CGO
ENV CGO_ENABLED=1
ENV GOOS=linux

# Set work directory
WORKDIR /app

# Copy source code
COPY . .

# Create directories
RUN mkdir -p /test/results

# Pre-download dependencies
RUN go mod download

# Default command (will be overridden)
CMD ["go", "version"]
